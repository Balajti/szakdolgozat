
schema {
  query: Query
  mutation: Mutation
}

type Query {
  getStudentDashboard(id: ID!): StudentDashboardPayload!
  getTeacherDashboard(id: ID!): TeacherDashboardPayload!
  listTeacherAssignments(teacherId: ID!): [AssignmentView!]!
  listStudentStories(studentId: ID!, limit: Int, nextToken: String): StoryConnection!
}

type Mutation {
  generateStory(input: StoryGenerationInput!): StoryGenerationPayload!
  updateWordMastery(input: UpdateWordMasteryInput!): Word!
  createTeacherAssignment(input: CreateAssignmentInput!): Assignment!
}

type StudentDashboardPayload {
  profile: StudentProfileView!
  recommendations: [StoryView!]!
}

type TeacherDashboardPayload {
  profile: TeacherProfileView!
  assignments: [AssignmentView!]!
  submissions: [SubmissionSummaryView!]!
  classes: [ClassSummaryView!]!
}

type StoryConnection {
  items: [StoryView!]!
  nextToken: String
}

type StudentProfileView {
  id: ID!
  name: String!
  email: AWSEmail!
  birthday: AWSDate
  avatarUrl: AWSURL
  level: String!
  streak: Int!
  vocabularyCount: Int!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  achievements: [AchievementView!]!
  words: [WordView!]!
  stories: [StoryView!]!
}

type TeacherProfileView {
  id: ID!
  name: String!
  email: AWSEmail!
  school: String
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Word {
  id: ID!
  studentId: ID!
  text: String!
  translation: String!
  exampleSentence: String
  mastery: WordMastery!
  lastReviewedAt: AWSDateTime
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum WordMastery {
  known
  learning
  unknown
}

type Story {
  id: ID!
  studentId: ID
  teacherId: ID
  title: String!
  content: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  level: String!
  mode: StoryGenerationMode
  unknownWordIds: [ID!]!
  highlightedWords: [HighlightedWord!]
}

type StoryView {
  id: ID!
  studentId: ID
  teacherId: ID
  title: String!
  content: String!
  level: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  mode: StoryGenerationMode
  unknownWordIds: [String!]
  highlightedWords: [HighlightedWord!]
}

type HighlightedWord {
  word: String!
  offset: Int!
  length: Int!
}

type Achievement {
  id: ID!
  studentId: ID!
  title: String!
  description: String!
  icon: String!
  achievedAt: AWSDate!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ClassSummary {
  id: ID!
  teacherId: ID!
  name: String!
  studentCount: Int!
  averageLevel: String!
  completionRate: Float!
  mostChallengingWord: String
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Assignment {
  id: ID!
  teacherId: ID!
  title: String!
  dueDate: AWSDate!
  level: String!
  status: AssignmentStatus!
  requiredWords: [String!]
  excludedWords: [String!]
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type AssignmentView {
  id: ID!
  teacherId: ID!
  title: String!
  dueDate: AWSDate!
  level: String!
  status: AssignmentStatus!
  requiredWords: [String!]
  excludedWords: [String!]
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum AssignmentStatus {
  draft
  sent
  submitted
  graded
}

type SubmissionSummaryView {
  id: ID!
  assignmentId: ID!
  teacherId: ID!
  studentId: ID!
  studentName: String!
  submittedAt: AWSDateTime!
  score: Int
  unknownWords: [String!]
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ClassSummaryView {
  id: ID!
  teacherId: ID!
  name: String!
  studentCount: Int!
  averageLevel: String!
  completionRate: Float!
  mostChallengingWord: String
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type StoryGenerationPayload {
  story: StoryView!
  newWords: [WordView!]!
}

type WordView {
  id: ID!
  studentId: ID!
  text: String!
  translation: String!
  exampleSentence: String
  mastery: WordMastery!
  lastReviewedAt: AWSDateTime
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type AchievementView {
  id: ID!
  studentId: ID!
  title: String!
  description: String!
  icon: String!
  achievedAt: AWSDate!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type StudentProfile {
  id: ID!
  name: String!
  email: AWSEmail!
  birthday: AWSDate
  avatarUrl: AWSURL
  level: String!
  streak: Int!
  vocabularyCount: Int!
  achievements: [Achievement!]!
  words: [Word!]!
  stories: [Story!]!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type TeacherProfile {
  id: ID!
  name: String!
  email: AWSEmail!
  school: String
  classes: [ClassSummary!]!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type SubmissionSummary {
  id: ID!
  assignmentId: ID!
  teacherId: ID!
  studentId: ID!
  studentName: String!
  submittedAt: AWSDateTime!
  score: Int
  unknownWords: [String!]!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type StoryGenerationInput {
  level: String!
  age: Int!
  knownWords: [String!]!
  unknownWords: [String!]!
  requiredWords: [String!]
  excludedWords: [String!]
  mode: StoryGenerationMode!
}

enum StoryGenerationMode {
  placement
  personalized
  teacher
}

input UpdateWordMasteryInput {
  studentId: ID!
  wordId: ID!
  mastery: WordMastery!
}

input CreateAssignmentInput {
  teacherId: ID!
  title: String!
  dueDate: AWSDate!
  level: String!
  requiredWords: [String!]
  excludedWords: [String!]
}
